<!DOCTYPE html>
<html>
  <head>
    <style>
      #map {
        height: 400px;
        width: 100%;
       }
    </style>
  </head>
  <body>
	<form name="dataform" action="javascript:clearMapAndGetNewPos()">
		Car name:   <input type='text' id='client'    value="testgps"   /><br>
		Start date: <input type='date' id='startdate' value="2017-06-17"/><br>
		End date:   <input type='date' id='enddate'   value="2017-06-20"/><br>
		Interval:   <input type='text' id='interval'  value="100"       />
		<input type="submit" value="Submit">
	</form>
	
    <h3>My Google Maps Demo</h3>
    <div id="map"></div>
    
	<script>
	var map = '';
	var markersArray = [];
	var flightPathArray = [];
	
	
	window.onload = function(){
		initMap();
		getGPSData();
	};

	function clearMapAndGetNewPos()
	{
		clearMarkers();
		clearFlightPath();
		getGPSData();
	
	}
	
	
	function initMap() {
        var centepoint = {lat: 50, lng: 0};
		
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 4,
          center: centepoint
        });
		
		
      }
	
	function getGPSData() {
		var xmlhttp = new XMLHttpRequest();
		var URLbase = "http://192.168.4.70:8080/gpstracker/position/";
		var client = document.getElementById('client').value;
		var startdate = document.getElementById('startdate').value;
		var enddate = document.getElementById('enddate').value;
		var interval = document.getElementById('interval').value;
		
		var url = URLbase + client + '/' + startdate + '/' + enddate +'/'+interval;

		xmlhttp.onreadystatechange = function() {
			if (this.readyState == 4 && this.status == 200) {
				var myArr = JSON.parse(this.responseText);
				parseResponseJson(myArr);
			}
		};
		xmlhttp.open("GET", url, true);
		xmlhttp.send();
	}
	

	function parseResponseJson(jresponse) {
		if (jresponse.status == 'ok') {
			var flightPlanCoordinates = [];
			for (var i = 0; i < jresponse.data.gpsdatalist.length; i++) {
				flightPlanCoordinates.push(
					{	
						lat : parseFloat(jresponse.data.gpsdatalist[i].lat),
						lng : parseFloat(jresponse.data.gpsdatalist[i].lng)
					});
				}
				
				var marker = new google.maps.Marker({
				  position: flightPlanCoordinates[0],
				  map : map
				  });
				  
				var marker = new google.maps.Marker({
				  position: flightPlanCoordinates[flightPlanCoordinates.length - 1],
				  map : map
				  });
				  
				markersArray.push(marker);
				
				
				var flightPath = new google.maps.Polyline({
				  path: flightPlanCoordinates,
				  geodesic: true,
				  strokeColor: '#FF0000',
				  strokeOpacity: 1.0,
				  strokeWeight: 2,
				   map : map
				});
				
				flightPathArray.push(flightPath);
		}	
	}
	
	function clearFlightPath() {
		while(flightPathArray.length) { flightPathArray.pop().setMap(null); }
	}
	
	function clearMarkers() {
		while(markersArray.length) { markersArray.pop().setMap(null); }
	}
    </script>
	
	
	<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCbh6_Jhpzj13qeM6Ujw_vjJZOK85o3SsI&callback=initMap">
    </script>
	
	
	
  </body>
</html>